{% extends 'base.html' %}
{% block content %}
<h2>Sudoku</h2>
<div id="sudoku-board">
<form id="sudoku-form">
<table>
{% for r in range(9) %}
<tr>
{% for c in range(9) %}
<td>
{% set v = board[r][c] %}
{% if v == 0 %}
<input name="cell-{{r}}-{{c}}" size="1" maxlength="1" />
{% else %}
<input value="{{v}}" readonly />
{% endif %}
</td>
{% endfor %}
</tr>
{% endfor %}
</table>
</form>
<button id="solve">Solve</button>
</div>
<script>
document.getElementById('solve').addEventListener('click', async ()=>{
const table = document.querySelectorAll('#sudoku-board input');
const board = [];
for(let r=0;r<9;r++){
const row=[];
for(let c=0;c<9;c++){
const el = document.querySelector(`input[name=cell-${r}-${c}]`);
if(el){ row.push(Number(el.value)||0);} else { row.push(Number(document.querySelectorAll('#sudoku-board input')[r*9+c].value); ) }
}
}
const res = await fetch('/api/sudoku/solve', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({board})});
const json = await res.json();
if(json.solved){
// reload page with solved board by replacing inputs
const solved = json.solved;
for(let r=0;r<9;r++){
for(let c=0;c<9;c++){
const sel = `input[name=cell-${r}-${c}]`;
const el = document.querySelector(sel);
if(el) el.value = solved[r][c];
else document.querySelectorAll('#sudoku-board input')[r*9+c].value = solved[r][c];
}
}
} else alert('No solution found');
});
</script>
{% endblock %}